@(skills: Seq[models.quiz.Skill], questions: Seq[(models.quiz.Question, Set[models.quiz.Skill])], data: Seq[controllers.library.QuestionList.QuestionListResponse])(implicit user: models.user.User)

@import com.artclod.play.s
@import controllers.library.QuestionList.formatQuestionListResponse
@import controllers.library.QuestionList.id
@import controllers.library.QuestionList.title
@import play.api.libs.json.Json

@mainContent("Library") {
  <h1>Welcome to the Calculus Tutor server Question Library</h1>

  <h2> New Question</h2>
  <section>
    <a class="pure-button" href="@controllers.library.routes.LibraryController.createQuestionView()"> Create a new question </a>
  </section>

  <h2> Question List</h2>
  <table class="pure-table pure-table-striped">
    <tr>
      <th>Name</th>
      @for(skill <- skills){<th><span data-ot="@skill.name">@skill.short_name</span></th>}
    </tr>
    @for(question <- questions){
    <tr>
        <td> <a href="@controllers.library.routes.LibraryController.viewQuestion(question._1.id, None)"> @question._1.title </a> </td>
        @for(skill <- skills){<td>@if(question._2.contains(skill)){ @tag.icon("icon-checkmark3") }else{ @tag.icon("icon-cross") }</td>}
    </tr>}
  </table>


  <section id="question-list-search">

  </section>
  <section id="question-list">
    <table class="pure-table pure-table-striped">
      <tr>
        <th>Name</th>
        @for(skill <- skills){<th><span data-ot="@skill.name">@skill.short_name</span></th>}
      </tr>
      <!-- ko foreach: $data -->
      <tr>
        <td> <a data-bind="text : @{title}(), attr: { href: '/library/question/' + @{id}(), title : @{title}() }"> </a> </td>
        @for(skill <- skills){<td data-bind="html : QL.si(skills(),'@skill.name')"> </td>}
      </tr>
      <!-- /ko -->
    </table>
  </section>

  <script type="text/javascript">

          // === The Answer Enhance Module ===
          // it knows how to enhance the view model with the MathJAX computations/displays etc
          var QL = function() {
            // Get the raw data into a var
            var data = @Html(Json.toJson(data).toString)

            // Turn it into a view model
            var viewModel = ko.mapping.fromJS(data);

            var skillIndicator = function(skillsList, skillName) {
              return skillsList.includes(skillName) ? '@tag.icon("icon-checkmark3")' : '@tag.icon("icon-cross")';
            };

            var skillsNames = @Html(skills.map(_.name).mkString("['", "','", "']"));
            var QL = {
              si : skillIndicator,
              skillsNames : skillsNames,
              viewModel : viewModel
            };
            return QL;
          }();

          // then applying bindings
          ko.applyBindings(QL.viewModel, document.getElementById("question-list"));
  </script>
}
